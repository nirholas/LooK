(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();class v{constructor(e,t,s={}){this.video=e,this.canvas=t,this.ctx=t.getContext("2d"),this.cursorData=s.cursorData||{frames:[],clicks:[]},this.zoomKeyframes=s.zoomKeyframes||[],this.settings=s.settings||{},this.cursorImage=null,this.loadCursorImage(),this.activeClicks=[],this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}loadCursorImage(){var i,o,n;const e=((i=this.settings.cursor)==null?void 0:i.style)||"default",t=((o=this.settings.cursor)==null?void 0:o.size)||24,s=((n=this.settings.cursor)==null?void 0:n.color)||"#000000",r=this.getCursorSVG(e,t,s);this.cursorImage=new Image,this.cursorImage.src=`data:image/svg+xml,${encodeURIComponent(r)}`}getCursorSVG(e,t,s){switch(e){case"pointer":return`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}" viewBox="0 0 24 24" fill="${s}">
          <path d="M7 2l12 11.2-5.8.5 3.3 7.3-2.5 1-3.2-7-4.8 4z"/>
        </svg>`;case"dot":return`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="6" fill="${s}"/>
        </svg>`;case"circle":return`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" fill="none" stroke="${s}" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" fill="${s}"/>
        </svg>`;case"none":return'<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"></svg>';default:return`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}" viewBox="0 0 24 24" fill="${s}">
          <path d="M4 1l15.5 13.4-6.1.5 3.5 6.4-2.4 1.3-3.5-6.4L4 22z"/>
        </svg>`}}resizeCanvas(){if(!this.video)return;const e=this.video.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height,this.videoWidth=this.video.videoWidth||1920,this.videoHeight=this.video.videoHeight||1080,this.scaleX=e.width/this.videoWidth,this.scaleY=e.height/this.videoHeight}updateSettings(e){this.settings={...this.settings,...e},this.loadCursorImage()}getCursorAt(e){const t=this.cursorData.frames||[];if(t.length===0)return null;const s=e*1e3;let r=t[0],i=Math.abs(t[0].t-s);for(const o of t){const n=Math.abs(o.t-s);if(n<i&&(r=o,i=n),o.t>s&&n>i)break}return r}getZoomAt(e){const t=this.zoomKeyframes||[];if(t.length===0)return{scale:1,x:0,y:0};const s=e*1e3;let r=t[0],i=t[t.length-1];for(let a=0;a<t.length-1;a++)if(t[a].time<=s&&t[a+1].time>=s){r=t[a],i=t[a+1];break}const o=i.time-r.time,n=o>0?(s-r.time)/o:0,l=n<.5?2*n*n:1-Math.pow(-2*n+2,2)/2;return{scale:r.zoom+(i.zoom-r.zoom)*l,x:r.x+(i.x-r.x)*l,y:r.y+(i.y-r.y)*l}}getClickAt(e){var i;const t=this.cursorData.clicks||[],s=e*1e3,r=((i=this.settings.clickEffect)==null?void 0:i.duration)||400;for(const o of t){const n=s-o.t;if(n>=0&&n<r)return{x:o.x,y:o.y,progress:n/r}}return null}render(e){var o,n,l,a,d;if(!this.video||this.video.readyState<2)return;this.canvas.width!==this.video.clientWidth&&this.resizeCanvas();const t=this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height);const s=this.getCursorAt(e),r=this.getZoomAt(e),i=this.getClickAt(e);if(this.applyZoomPreview(r),i&&((o=this.settings.clickEffect)==null?void 0:o.type)!=="none"&&this.drawClickEffect(i),s&&this.cursorImage&&((n=this.settings.cursor)==null?void 0:n.style)!=="none"){const h=s.x*this.scaleX,p=s.y*this.scaleY;t.drawImage(this.cursorImage,h-(((l=this.settings.cursor)==null?void 0:l.size)||24)/2,p-2,((a=this.settings.cursor)==null?void 0:a.size)||24,((d=this.settings.cursor)==null?void 0:d.size)||24)}}applyZoomPreview(e){if(!(!this.video||!this.video.parentElement))if(e.scale>1.01){const s=(e.x||0)*this.scaleX,r=(e.y||0)*this.scaleY;this.video.style.transform=`scale(${e.scale}) translate(${-s}px, ${-r}px)`,this.video.style.transformOrigin="center center"}else this.video.style.transform=""}drawClickEffect(e){var g,y,f;const t=this.ctx,s=e.x*this.scaleX,r=e.y*this.scaleY,i=e.progress,o=((g=this.settings.clickEffect)==null?void 0:g.size)||60,n=((y=this.settings.clickEffect)==null?void 0:y.color)||"#3B82F6",l=((f=this.settings.clickEffect)==null?void 0:f.type)||"ripple",a=n.replace("#",""),d=parseInt(a.substr(0,2),16),h=parseInt(a.substr(2,2),16),p=parseInt(a.substr(4,2),16);switch(l){case"ripple":this.drawRipple(t,s,r,i,o,d,h,p);break;case"pulse":this.drawPulse(t,s,r,i,o,d,h,p);break;case"ring":this.drawRing(t,s,r,i,o,d,h,p);break;case"spotlight":this.drawSpotlight(t,s,r,i,o,d,h,p);break}}drawRipple(e,t,s,r,i,o,n,l){const a=r*i,d=(1-r)*.6;e.beginPath(),e.arc(t,s,a,0,Math.PI*2),e.fillStyle=`rgba(${o}, ${n}, ${l}, ${d})`,e.fill(),e.beginPath(),e.arc(t,s,a*.7,0,Math.PI*2),e.strokeStyle=`rgba(${o}, ${n}, ${l}, ${d*1.5})`,e.lineWidth=2,e.stroke()}drawPulse(e,t,s,r,i,o,n,l){const a=10+r*(i-10),d=Math.sin(r*Math.PI)*.6;e.beginPath(),e.arc(t,s,a,0,Math.PI*2),e.fillStyle=`rgba(${o}, ${n}, ${l}, ${d})`,e.fill()}drawRing(e,t,s,r,i,o,n,l){const a=r*i,d=(1-r)*.8;e.beginPath(),e.arc(t,s,a,0,Math.PI*2),e.strokeStyle=`rgba(${o}, ${n}, ${l}, ${d})`,e.lineWidth=3,e.stroke()}drawSpotlight(e,t,s,r,i,o,n,l){const a=i*(1-r*.5),d=(1-r)*.4,h=e.createRadialGradient(t,s,0,t,s,a);h.addColorStop(0,`rgba(${o}, ${n}, ${l}, ${d})`),h.addColorStop(1,`rgba(${o}, ${n}, ${l}, 0)`),e.beginPath(),e.arc(t,s,a,0,Math.PI*2),e.fillStyle=h,e.fill()}}const w="";async function m(c,e,t=null){const s={method:c,headers:{}};t&&(s.headers["Content-Type"]="application/json",s.body=JSON.stringify(t));const r=await fetch(`${w}${e}`,s);if(!r.ok){const i=await r.json().catch(()=>({error:r.statusText}));throw new Error(i.error||"Request failed")}return r.json()}const u={health(){return m("GET","/api/health")},getProjects(){return m("GET","/api/projects")},getProject(c){return m("GET",`/api/project/${c}`)},deleteProject(c){return m("DELETE",`/api/project/${c}`)},analyze(c,e={}){return m("POST","/api/analyze",{url:c,duration:e.duration||25,style:e.style||"professional"})},record(c,e={}){return m("POST","/api/record",{projectId:c,options:e})},generateVoice(c,e,t="nova"){return m("POST","/api/voice",{projectId:c,script:e,voice:t})},updateProject(c,e){return m("PUT",`/api/project/${c}/settings`,e)},render(c,e="youtube"){return m("POST","/api/render",{projectId:c,preset:e})},getCursorData(c){return m("GET",`/api/preview/${c}/cursor`)}};class E{constructor(){this.currentProject=null,this.previewRenderer=null,this.ws=null,this.elements={startScreen:document.getElementById("start-screen"),analyzeForm:document.getElementById("analyze-form"),urlInput:document.getElementById("url-input"),projectsList:document.getElementById("projects-list"),editorScreen:document.getElementById("editor-screen"),exportBtn:document.getElementById("export-btn"),previewVideo:document.getElementById("preview-video"),cursorOverlay:document.getElementById("cursor-overlay"),playBtn:document.getElementById("play-btn"),seekBar:document.getElementById("seek-bar"),timeDisplay:document.getElementById("time-display"),timeline:document.getElementById("timeline"),timelineTrack:document.getElementById("timeline-track"),timelineProgress:document.getElementById("timeline-progress"),playhead:document.getElementById("playhead"),trimStart:document.getElementById("trim-start"),trimEnd:document.getElementById("trim-end"),timeMarkers:document.querySelectorAll(".time-marker"),scriptEditor:document.getElementById("script-editor"),voiceSelect:document.getElementById("voice-select"),regenerateVoiceBtn:document.getElementById("regenerate-voice-btn"),analysisDisplay:document.getElementById("analysis-display"),zoomMode:document.getElementById("zoom-mode"),zoomIntensity:document.getElementById("zoom-intensity"),zoomSpeed:document.getElementById("zoom-speed"),cursorStyle:document.getElementById("cursor-style"),cursorSize:document.getElementById("cursor-size"),cursorColor:document.getElementById("cursor-color"),clickEffect:document.getElementById("click-effect"),clickColor:document.getElementById("click-color"),exportPreset:document.getElementById("export-preset"),tabBtns:document.querySelectorAll(".tab-btn"),scriptTab:document.getElementById("script-tab"),settingsTab:document.getElementById("settings-tab"),statusMessage:document.getElementById("status-message"),progressContainer:document.getElementById("progress-container"),progressBar:document.getElementById("progress-bar"),exportModal:document.getElementById("export-modal"),exportFormat:document.getElementById("export-format"),exportProgress:document.getElementById("export-progress"),exportProgressBar:document.getElementById("export-progress-bar"),exportStatus:document.getElementById("export-status"),cancelExport:document.getElementById("cancel-export"),startExport:document.getElementById("start-export")},this.init()}async init(){this.setupEventListeners(),this.connectWebSocket(),await this.loadRecentProjects()}setupEventListeners(){this.elements.analyzeForm.addEventListener("submit",t=>{t.preventDefault(),this.analyzeUrl(this.elements.urlInput.value)}),this.elements.playBtn.addEventListener("click",()=>this.togglePlayback()),this.elements.seekBar.addEventListener("input",t=>this.seekTo(t.target.value)),this.elements.previewVideo.addEventListener("timeupdate",()=>this.updateTimeDisplay()),this.elements.previewVideo.addEventListener("loadedmetadata",()=>this.onVideoLoaded()),this.elements.timelineTrack.addEventListener("click",t=>{const s=t.target.getBoundingClientRect(),r=(t.clientX-s.left)/s.width;this.seekToPercent(r)}),this.elements.regenerateVoiceBtn.addEventListener("click",()=>this.regenerateVoice()),["zoomMode","zoomIntensity","zoomSpeed","cursorStyle","cursorSize","cursorColor","clickEffect","clickColor","exportPreset"].forEach(t=>{const s=this.elements[t];s&&s.addEventListener("change",()=>this.onSettingsChange())}),this.elements.tabBtns.forEach(t=>{t.addEventListener("click",()=>{this.elements.tabBtns.forEach(r=>r.classList.remove("active")),t.classList.add("active");const s=t.dataset.tab;this.elements.scriptTab.classList.toggle("hidden",s!=="script"),this.elements.settingsTab.classList.toggle("hidden",s!=="settings")})}),this.elements.exportBtn.addEventListener("click",()=>this.showExportModal()),this.elements.cancelExport.addEventListener("click",()=>this.hideExportModal()),this.elements.startExport.addEventListener("click",()=>this.startExport()),this.elements.exportModal.addEventListener("click",t=>{t.target===this.elements.exportModal&&this.hideExportModal()})}connectWebSocket(){const e=`ws://${window.location.host}`;this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("WebSocket connected")},this.ws.onmessage=t=>{const{type:s,data:r}=JSON.parse(t.data);this.handleWebSocketMessage(s,r)},this.ws.onclose=()=>{console.log("WebSocket disconnected, reconnecting..."),setTimeout(()=>this.connectWebSocket(),3e3)}}handleWebSocketMessage(e,t){switch(e){case"status":this.setStatus(t.message),t.progress!==void 0&&this.setProgress(t.progress);break;case"error":this.setStatus(`Error: ${t.message}`,"error");break;case"render-progress":this.elements.exportProgress&&(this.elements.exportProgressBar.style.width=`${t.progress}%`,this.elements.exportStatus.textContent=t.stage==="complete"?"Complete!":`${t.stage}... ${t.progress}%`);break}}async loadRecentProjects(){try{const{projects:e}=await u.getProjects();this.renderProjectsList(e)}catch(e){console.error("Failed to load projects:",e)}}renderProjectsList(e){this.elements.projectsList.innerHTML=e.length===0?'<li class="empty">No recent projects</li>':e.slice(0,5).map(t=>`
          <li data-id="${t.id}">
            <span class="project-name">${t.name||t.url}</span>
            <span class="project-date">${this.formatDate(t.updatedAt)}</span>
          </li>
        `).join(""),this.elements.projectsList.querySelectorAll("li[data-id]").forEach(t=>{t.addEventListener("click",()=>this.loadProject(t.dataset.id))})}formatDate(e){const t=new Date(e),r=new Date-t,i=Math.floor(r/6e4),o=Math.floor(r/36e5),n=Math.floor(r/864e5);return i<1?"Just now":i<60?`${i}m ago`:o<24?`${o}h ago`:n<7?`${n}d ago`:t.toLocaleDateString()}async analyzeUrl(e){this.setStatus("Analyzing website...","loading"),this.showProgress();try{const t=await u.analyze(e);this.currentProject=t,this.setStatus("Analysis complete! Starting recording...");const s=await u.record(t.projectId);await this.loadProject(t.projectId)}catch(t){this.setStatus(`Error: ${t.message}`,"error"),this.hideProgress()}}async loadProject(e){this.setStatus("Loading project...");try{const t=await u.getProject(e);this.currentProject=t,this.showEditor(),t.hasRawVideo&&(this.elements.previewVideo.src=`/api/preview/${e}/video`),this.elements.scriptEditor.value=t.script||"",this.renderAnalysis(t.analysis),this.loadSettings(t.settings);const s=await u.getCursorData(e);this.previewRenderer=new v(this.elements.previewVideo,this.elements.cursorOverlay,s),this.elements.exportBtn.disabled=!t.hasRawVideo,this.setStatus("Ready"),this.hideProgress()}catch(t){this.setStatus(`Error loading project: ${t.message}`,"error")}}showEditor(){this.elements.startScreen.classList.add("hidden"),this.elements.editorScreen.classList.remove("hidden")}showStartScreen(){this.elements.editorScreen.classList.add("hidden"),this.elements.startScreen.classList.remove("hidden")}renderAnalysis(e){var s;if(!e){this.elements.analysisDisplay.innerHTML="<em>No analysis available</em>";return}const t=[];e.name&&t.push(`<div class="analysis-item"><span class="label">Name</span><br>${e.name}</div>`),e.tagline&&t.push(`<div class="analysis-item"><span class="label">Tagline</span><br>${e.tagline}</div>`),e.targetAudience&&t.push(`<div class="analysis-item"><span class="label">Audience</span><br>${e.targetAudience}</div>`),(s=e.keyFeatures)!=null&&s.length&&t.push(`<div class="analysis-item"><span class="label">Key Features</span><br>• ${e.keyFeatures.join("<br>• ")}</div>`),this.elements.analysisDisplay.innerHTML=t.join("")||"<em>No analysis available</em>"}loadSettings(e){e&&(e.zoom&&(this.elements.zoomMode.value=e.zoom.mode||"smart",this.elements.zoomIntensity.value=(e.zoom.intensity||.5)*100,this.elements.zoomSpeed.value=e.zoom.speed||"medium"),e.cursor&&(this.elements.cursorStyle.value=e.cursor.style||"default",this.elements.cursorSize.value=e.cursor.size||24,this.elements.cursorColor.value=e.cursor.color||"#000000"),e.clickEffect&&(this.elements.clickEffect.value=e.clickEffect.type||"ripple",this.elements.clickColor.value=e.clickEffect.color||"#3B82F6"),this.elements.exportPreset.value=e.preset||"youtube",this.elements.voiceSelect.value=e.voice||"nova")}getSettings(){return{zoom:{mode:this.elements.zoomMode.value,intensity:parseInt(this.elements.zoomIntensity.value)/100,speed:this.elements.zoomSpeed.value},cursor:{style:this.elements.cursorStyle.value,size:parseInt(this.elements.cursorSize.value),color:this.elements.cursorColor.value},clickEffect:{type:this.elements.clickEffect.value,color:this.elements.clickColor.value},preset:this.elements.exportPreset.value,voice:this.elements.voiceSelect.value}}async onSettingsChange(){var e;if((e=this.currentProject)!=null&&e.id)try{await u.updateProject(this.currentProject.id,{settings:this.getSettings()}),this.previewRenderer&&this.previewRenderer.updateSettings(this.getSettings())}catch(t){console.error("Failed to save settings:",t)}}async regenerateVoice(){var s;if(!((s=this.currentProject)!=null&&s.id))return;const e=this.elements.scriptEditor.value,t=this.elements.voiceSelect.value;this.setStatus("Generating voiceover..."),this.elements.regenerateVoiceBtn.disabled=!0;try{await u.generateVoice(this.currentProject.id,e,t),this.setStatus("Voiceover generated"),await this.loadProject(this.currentProject.id)}catch(r){this.setStatus(`Error: ${r.message}`,"error")}finally{this.elements.regenerateVoiceBtn.disabled=!1}}togglePlayback(){const e=this.elements.previewVideo;e.paused?(e.play(),this.elements.playBtn.textContent="⏸️",this.startPreviewLoop()):(e.pause(),this.elements.playBtn.textContent="▶️",this.stopPreviewLoop())}seekTo(e){const t=this.elements.previewVideo,s=e/100*t.duration;t.currentTime=s,this.updatePlayhead(e/100)}seekToPercent(e){const t=this.elements.previewVideo;t.currentTime=e*t.duration,this.elements.seekBar.value=e*100,this.updatePlayhead(e)}updateTimeDisplay(){const e=this.elements.previewVideo,t=this.formatTime(e.currentTime),s=this.formatTime(e.duration||0);this.elements.timeDisplay.textContent=`${t} / ${s}`;const r=e.currentTime/e.duration*100;this.elements.seekBar.value=r,this.updatePlayhead(r/100)}updatePlayhead(e){this.elements.playhead.style.left=`${e*100}%`,this.elements.timelineProgress.style.width=`${e*100}%`}onVideoLoaded(){const e=this.elements.previewVideo.duration,t=this.elements.timeMarkers;for(let s=0;s<t.length;s++){const r=e/(t.length-1)*s;t[s].textContent=this.formatTime(r)}}formatTime(e){const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`}startPreviewLoop(){this.previewLoopId=requestAnimationFrame(()=>this.previewLoop())}stopPreviewLoop(){this.previewLoopId&&(cancelAnimationFrame(this.previewLoopId),this.previewLoopId=null)}previewLoop(){this.previewRenderer&&this.previewRenderer.render(this.elements.previewVideo.currentTime),this.elements.previewVideo.paused||(this.previewLoopId=requestAnimationFrame(()=>this.previewLoop()))}showExportModal(){this.elements.exportModal.classList.remove("hidden"),this.elements.exportProgress.classList.add("hidden"),this.elements.startExport.disabled=!1}hideExportModal(){this.elements.exportModal.classList.add("hidden")}async startExport(){var t;if(!((t=this.currentProject)!=null&&t.id))return;const e=this.elements.exportFormat.value;this.elements.exportProgress.classList.remove("hidden"),this.elements.startExport.disabled=!0,this.elements.exportProgressBar.style.width="0%",this.elements.exportStatus.textContent="Starting render...";try{const s=await u.render(this.currentProject.id,e);this.elements.exportStatus.textContent="Complete! Downloading...",window.location.href=`/api/download/${this.currentProject.id}`,setTimeout(()=>this.hideExportModal(),2e3)}catch(s){this.elements.exportStatus.textContent=`Error: ${s.message}`}}setStatus(e,t="info"){this.elements.statusMessage.textContent=e,this.elements.statusMessage.className=`status-message ${t}`}showProgress(){this.elements.progressContainer.classList.remove("hidden")}hideProgress(){this.elements.progressContainer.classList.add("hidden")}setProgress(e){this.elements.progressBar.style.width=`${e}%`}}document.addEventListener("DOMContentLoaded",()=>{window.app=new E});
